/*
* @nebula.js/theme v0.1.0-alpha.29
* Copyright (c) 2020 QlikTech International AB
* Released under the MIT license.
*/

import t from"node-event-emitter";import{color as e}from"d3-color";var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,l=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===o.call(t)},c=function(t){if(!t||"[object Object]"!==o.call(t))return!1;var e,n=r.call(t,"constructor"),a=t.constructor&&t.constructor.prototype&&r.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!a)return!1;for(e in t);return void 0===e||r.call(t,e)},i=function(t,e){n&&"__proto__"===e.name?n(t,e.name,{enumerable:!0,configurable:!0,value:e.newValue,writable:!0}):t[e.name]=e.newValue},u=function(t,e){if("__proto__"===e){if(!r.call(t,e))return;if(a)return a(t,e).value}return t[e]},f=function t(){var e,r,o,n,a,f,s=arguments[0],p=1,y=arguments.length,C=!1;for("boolean"==typeof s&&(C=s,s=arguments[1]||{},p=2),(null==s||"object"!=typeof s&&"function"!=typeof s)&&(s={});p<y;++p)if(null!=(e=arguments[p]))for(r in e)o=u(s,r),s!==(n=u(e,r))&&(C&&n&&(c(n)||(a=l(n)))?(a?(a=!1,f=o&&l(o)?o:[]):f=o&&c(o)?o:{},i(s,{name:r,newValue:t(C,f,n)})):void 0!==n&&i(s,{name:r,newValue:n}));return s},s={fontSize:"13px",fontFamily:"'Source Sans Pro', 'Arial', 'sans-serif'",backgroundColor:"transparent",dataColors:{primaryColor:"#26a0a7",othersColor:"#a5a5a5",errorColor:"#ff4444",nullColor:"#d2d2d2"},scales:[{name:"Sequential Gradient",translation:"properties.colorScheme.sequential",type:"gradient",propertyValue:"sg",scale:["#26a0a7","#c7ea8b"]},{name:"Sequential Classes",translation:"properties.colorScheme.sequentialC",propertyValue:"sc",type:"class",scale:["#26a0a7","#c7ea8b"]},{name:"Diverging gradient",translation:"properties.colorScheme.diverging",propertyValue:"dg",type:"gradient",scale:["#26a0a7","#c3ea8c","#ec983d"]},{name:"Diverging Classes",translation:"properties.colorScheme.divergingC",propertyValue:"dc",type:"class",scale:["#26a0a7","#c3ea8c","#ec983d"]}],palettes:{data:[{name:"12 Colors",translation:"properties.colorNumberOfColors.12",propertyValue:"12",type:"pyramid",scale:[["#26A0A7"],["#26A0A7","#EC983D"],["#26A0A7","#CBE989","#EC983D"],["#26A0A7","#79D69F","#F9EC86","#EC983D"],["#26A0A7","#79D69F","#CBE989","#F9EC86","#EC983D"],["#26A0A7","#65D3DA","#79D69F","#CBE989","#F9EC86","#EC983D"],["#26A0A7","#65D3DA","#79D69F","#CBE989","#F9EC86","#EC983D","#D76C6C"],["#26A0A7","#65D3DA","#79D69F","#CBE989","#F9EC86","#FAD144","#EC983D","#D76C6C"],["#138185","#26A0A7","#65D3DA","#79D69F","#CBE989","#F9EC86","#FAD144","#EC983D","#D76C6C"],["#138185","#26A0A7","#65D3DA","#79D69F","#CBE989","#EBF898","#F9EC86","#FAD144","#EC983D","#D76C6C"],["#138185","#26A0A7","#65D3DA","#79D69F","#CBE989","#EBF898","#F9EC86","#FAD144","#EC983D","#D76C6C","#A54343"],["#138185","#26A0A7","#65D3DA","#79D69F","#70BA6E","#CBE989","#EBF898","#F9EC86","#FAD144","#EC983D","#D76C6C","#A54343"]]}],ui:[{name:"Palette",colors:["#b0afae","#7b7a78","#a54343","#d76c6c","#ec983d","#ecc43d","#f9ec86","#cbe989","#70ba6e","#578b60","#79d69f","#26a0a7","#138185","#65d3da","#ffffff","#000000"]}]}},p={_variables:{"@B20":"#333333","@B35":"#595959","@B45":"#737373","@B50":"#808080","@B60":"#999999","@B80":"#cccccc","@B90":"#e6e6e6","@B98":"#fbfbfb","@B100":"#ffffff","@H1":"24px","@H2":"18px","@H3":"14px","@H4":"13px","@H5":"12px","@H6":"10px"},type:"light",color:"@B35"},y={_variables:{"@B20":"#333333","@B35":"#595959","@B45":"#737373","@B50":"#808080","@B60":"#999999","@B80":"#cccccc","@B90":"#e6e6e6","@B98":"#fbfbfb","@B100":"#ffffff","@H1":"24px","@H2":"18px","@H3":"14px","@H4":"13px","@H5":"12px","@H6":"10px"},type:"dark",color:"@B98"};function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],o=!0,n=!1,a=void 0;try{for(var l,c=t[Symbol.iterator]();!(o=(l=c.next()).done)&&(r.push(l.value),!e||r.length!==e);o=!0);}catch(t){n=!0,a=t}finally{try{o||null==c.return||c.return()}finally{if(n)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function m(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(t,e){var r,o,n=[];if(t)for(var a=t.length;a>=0;){for(o=(r=e.slice()).length;o>=0;)n.push(r.concat(t)),r.pop(),o--;t.pop(),a--}else for(o=(r=e.slice()).length;o>=0;)n.push(r.concat()),r.pop(),o--;return n}function b(t,e){for(var r=t,o=0;o<e.length;o++){if(!r[e[o]])return null;r=r[e[o]]}return r}function D(t,e,r,o){var n;""===t?n=A(null,r):n=A(t.split("."),r);return function(t,e,r){for(var o=0;o<t.length;o++){var n=b(r,t[o]);if(null!==n&&n[e])return n[e]}}(n,e,o)}function g(t,e){var r=t.split(".");return{getStyle:function(t,o){return D(t,o,r.concat(),e)}}}function h(t){var r=e(t).rgb(),o=d([r.r,r.g,r.b].map((function(t){return t/255})),3),n=d([o[0],o[1],o[2]].map((function(t){return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),3);return+(.2126*n[0]+.7152*n[1]+.0722*n[2]).toFixed(5)}function v(t,e){return+((Math.max(t,e)+.05)/(Math.min(t,e)+.05)).toFixed(5)}g.resolveRawTheme=function(t){var e=f(!0,{},t);return function t(e,r){Object.keys(e).forEach((function(o){"object"===C(e[o])&&null!==e[o]?t(e[o],r):"string"==typeof e[o]&&"@"===e[o].charAt(0)&&(e[o]=r[e[o]])}))}(e,e._variables),e};export default function(){var e,r,o,n={},a={getDataColorScales:function(){return r.dataScales()},getDataColorPalettes:function(){return r.dataPalettes()},getDataColorPickerPalettes:function(){return r.uiPalettes()},getDataColorSpecials:function(){return r.dataColors()},getColorPickerColor:function(){var t;return(t=r).uiColor.apply(t,arguments)},getContrastingColorTo:function(t){return o.getBestContrastColor(t)},getStyle:function(t,r,o){return n[t]||(n[t]=g(t,e)),n[t].getStyle(r,o,!1)}},l={setTheme:function(t,l){var c,i;e=function(t,e){var r="dark"===t.type?y:p,o=f(!0,{},s,r),n=f(!0,{},o,{scales:null,palettes:{data:null,ui:null}},t);return n.palettes.data||(n.palettes.data=o.palettes.data),n.palettes.ui||(n.palettes.ui=o.palettes.ui),n.scales||(n.scales=o.scales),e(n)}(t,g.resolveRawTheme),n={},c=e,r={dataScales:function(){var t=[];return c.scales.forEach((function(e){t.push({key:e.propertyValue,name:e.name,translation:e.translation,scheme:!0,type:e.type,colors:e.scale})})),t},dataPalettes:function(){var t=[];return c.palettes.data.forEach((function(e){t.push({key:e.propertyValue,name:e.name,translation:e.translation,type:e.type,colors:e.scale})})),t},uiPalettes:function(){var t=[];return c.palettes.ui.forEach((function(e){t.push({key:"ui",name:e.name,translation:e.translation,type:"row",colors:e.colors})})),t},dataColors:function(){return{primary:c.dataColors.primaryColor,nil:c.dataColors.nullColor,others:c.dataColors.othersColor}},uiColor:function(t){return t.index<0||void 0===t.index?t.color:(void 0===i&&(i=this.uiPalettes()[0]||!1),i?void 0===i.colors[t.index]?t.color:i.colors[t.index]:t.color)}};var u=a.getStyle("","","color"),C=h(u);o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["#333333","#ffffff"],e={},r=0,o=t.map(h);return{getBestContrastColor:function(n){if(!e[n]){r>1e3&&(e={},r=0);var a=h(n),l=o.map((function(t){return v(a,t)})),c=t[l.indexOf(Math.max.apply(Math,m(l)))];e[n]=c,r++}return e[n]}}}([u,C<.2?"#ffffff":"#333333"]),a.emit("changed"),a.name=function(){return l}}};return Object.keys(t.prototype).forEach((function(e){a[e]=t.prototype[e]})),t.init(a),l.setTheme({},"light"),{externalAPI:a,internalAPI:l}}
